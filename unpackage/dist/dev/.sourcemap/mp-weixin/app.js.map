{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\nexport default {\n  globalData: {\n    socketConnected: false\n  },\n\n  onLaunch() {\n    this.initGlobalSocket()\n  },\n\n  methods: {\n    initGlobalSocket() {\n      const token = uni.getStorageSync('token')\n      const userInfo = uni.getStorageSync('userInfo')\n      if (!token || !userInfo?.id) return\n\n      console.log('【全局】准备连接 WebSocket')\n\n      uni.connectSocket({\n        url: `ws://192.168.0.105:8080/ws/chat?token=${token}&userId=${userInfo.id}`\n      })\n\n      // 全局监听（关键！）\n      uni.onSocketOpen(() => {\n        console.log('【全局】WebSocket 连接成功')\n        this.globalData.socketConnected = true\n      })\n\n      uni.onSocketMessage((res) => {\n        try {\n          const data = JSON.parse(res.data)\n          if (data.type === 'message') {\n            uni.$emit('newChatMessage', data.msg)\n          }\n        } catch (e) {}\n      })\n\n      uni.onSocketError((err) => {\n        console.log('【全局】WebSocket 错误', err)\n        this.globalData.socketConnected = false\n      })\n\n      // 绝对不要写 uni.closeSocket()！！\n      // 微信自己会清理，我们只负责监听关闭后重连\n      uni.onSocketClose(() => {\n        console.log('【全局】WebSocket 已关闭，3秒后重连')\n        this.globalData.socketConnected = false\n        setTimeout(() => {\n          this.initGlobalSocket()\n        }, 3000)\n      })\n    }\n  }\n}\n</script>","\n// #ifndef VUE3\r\nimport Vue from 'vue'\r\nimport App from './App'\r\n\r\nVue.config.productionTip = false\r\n\r\nApp.mpType = 'app'\r\n\r\nconst app = new Vue({\r\n    ...App\r\n})\r\napp.$mount()\r\n// #endif\n\n// #ifdef VUE3\r\nimport { createSSRApp } from 'vue'\nimport App from './App.vue'\nexport function createApp() {\n  const app = createSSRApp(App)\n  return {\n    app\n  }\n}\r\n// #endif"],"names":["uni","createSSRApp","App"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,MAAK,YAAU;AAAA,EACb,YAAY;AAAA,IACV,iBAAiB;AAAA,EAClB;AAAA,EAED,WAAW;AACT,SAAK,iBAAiB;AAAA,EACvB;AAAA,EAED,SAAS;AAAA,IACP,mBAAmB;AACjB,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,YAAM,WAAWA,cAAAA,MAAI,eAAe,UAAU;AAC9C,UAAI,CAAC,SAAS,EAAC,qCAAU;AAAI;AAE7BA,oBAAAA,MAAY,MAAA,OAAA,iBAAA,oBAAoB;AAEhCA,oBAAAA,MAAI,cAAc;AAAA,QAChB,KAAK,yCAAyC,KAAK,WAAW,SAAS,EAAE;AAAA,OAC1E;AAGDA,oBAAG,MAAC,aAAa,MAAM;AACrBA,sBAAAA,MAAA,MAAA,OAAA,iBAAY,oBAAoB;AAChC,aAAK,WAAW,kBAAkB;AAAA,OACnC;AAEDA,0BAAI,gBAAgB,CAAC,QAAQ;AAC3B,YAAI;AACF,gBAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChC,cAAI,KAAK,SAAS,WAAW;AAC3BA,0BAAAA,MAAI,MAAM,kBAAkB,KAAK,GAAG;AAAA,UACtC;AAAA,iBACO,GAAG;AAAA,QAAC;AAAA,OACd;AAEDA,0BAAI,cAAc,CAAC,QAAQ;AACzBA,sBAAAA,MAAA,MAAA,OAAA,iBAAY,oBAAoB,GAAG;AACnC,aAAK,WAAW,kBAAkB;AAAA,OACnC;AAIDA,oBAAG,MAAC,cAAc,MAAM;AACtBA,sBAAAA,MAAY,MAAA,OAAA,iBAAA,yBAAyB;AACrC,aAAK,WAAW,kBAAkB;AAClC,mBAAW,MAAM;AACf,eAAK,iBAAiB;AAAA,QACvB,GAAE,GAAI;AAAA,OACR;AAAA,IACH;AAAA,EACF;AACF;ACnCO,SAAS,YAAY;AAC1B,QAAM,MAAMC,cAAY,aAACC,SAAG;AAC5B,SAAO;AAAA,IACL;AAAA,EACD;AACH;;;"}