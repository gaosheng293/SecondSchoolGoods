{"version":3,"file":"my-orders.js","sources":["pages/mine/my-orders.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWluZS9teS1vcmRlcnMudnVl"],"sourcesContent":["<!-- pages/mine/my-orders.vue （终极完整版）-->\r\n<template>\r\n  <view class=\"orders-page\">\r\n    <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n\r\n    <!-- 顶部导航栏 + 返回 -->\r\n    <view class=\"nav-bar\">\r\n      <view class=\"left\" @click=\"goBack\">\r\n        <uni-icons type=\"back\" size=\"40\" color=\"#333\" />\r\n      </view>\r\n      <view class=\"title\">我的订单</view>\r\n      <view class=\"right\"></view>\r\n    </view>\r\n\r\n    <!-- 完整6个Tab -->\r\n    <view class=\"tabs\">\r\n      <view class=\"tab-item\" :class=\"{ active: activeTab === null }\" @click=\"switchTab(null)\">全部</view>\r\n      <view class=\"tab-item\" :class=\"{ active: activeTab === 0 }\" @click=\"switchTab(0)\">待支付</view>\r\n      <view class=\"tab-item\" :class=\"{ active: activeTab === 1 }\" @click=\"switchTab(1)\">待发货</view>\r\n      <view class=\"tab-item\" :class=\"{ active: activeTab === 2 }\" @click=\"switchTab(2)\">待收货</view>\r\n      <view class=\"tab-item\" :class=\"{ active: activeTab === 3 }\" @click=\"switchTab(3)\">已完成</view>\r\n      <view class=\"tab-item\" :class=\"{ active: activeTab === 4 }\" @click=\"switchTab(4)\">退款中</view>\r\n    </view>\r\n\r\n    <!-- 订单列表 -->\r\n    <scroll-view scroll-y class=\"order-list\" lower-threshold=\"50\" @scrolltolower=\"loadMore\">\r\n      <view v-for=\"item in orderList\" :key=\"item.id\" class=\"order-item\" @click=\"toDetail(item.id)\">\r\n        <view class=\"goods-info\">\r\n          <image :src=\"item.cover || '/static/default-cover.png'\" mode=\"aspectFill\" class=\"cover\" />\r\n          <view class=\"details\">\r\n            <text class=\"title\">{{ item.goodsTitle || '未知商品' }}</text>\r\n            <text class=\"price\">¥{{ item.price }} × {{ item.quantity || 1 }}</text>\r\n          </view>\r\n        </view>\r\n\r\n        <view class=\"footer\">\r\n          <text class=\"status\" :class=\"getStatusClass(item.status)\">\r\n            {{ statusMap[item.status] }}\r\n          </text>\r\n          <view class=\"actions\">\r\n            <!-- 待支付 -->\r\n            <button v-if=\"item.status === 0\" class=\"btn pay\" @click.stop=\"pay(item.id)\">立即支付</button>\r\n            <!-- 待收货 -->\r\n            <button v-if=\"item.status === 2\" class=\"btn confirm\" @click.stop=\"confirmReceive(item.id)\">确认收货</button>\r\n            <!-- 退款中 -->\r\n            <button v-if=\"item.status === 4\" class=\"btn refund\" @click.stop=\"contactSeller\">联系客服</button>\r\n            <!-- 已完成 / 已退款 -->\r\n            <button v-if=\"item.status === 3 || item.status === 5\" class=\"btn plain\" @click.stop=\"toDetail(item.id)\">查看详情</button>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 空状态 -->\r\n      <view class=\"empty\" v-if=\"!orderList.length && !loading\">\r\n        <image src=\"/static/empty-order.png\" class=\"empty-img\" mode=\"widthFix\" />\r\n        <text class=\"empty-text\">暂无{{ activeTab === null ? '' : statusMap[activeTab] }}订单</text>\r\n        <button class=\"go-shop\" @click=\"toHome\">去首页逛逛</button>\r\n      </view>\r\n\r\n      <view class=\"loading\" v-if=\"loading\">\r\n        <uni-icons type=\"spinner\" size=\"30\" spin />\r\n        <text>加载中...</text>\r\n      </view>\r\n    </scroll-view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      statusBarHeight: 0,\r\n      activeTab: null,\r\n      orderList: [],\r\n      loading: false,\r\n      statusMap: {\r\n        0: '待支付',\r\n        1: '待发货',\r\n        2: '待收货',\r\n        3: '已完成',\r\n        4: '退款中',\r\n        5: '已退款'\r\n      }\r\n    }\r\n  },\r\n\r\n  onLoad() {\r\n    this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight\r\n    this.loadOrders()\r\n  },\r\n\r\n  onPullDownRefresh() {\r\n    this.loadOrders(() => uni.stopPullDownRefresh())\r\n  },\r\n\r\n  methods: {\r\n    switchTab(tab) {\r\n      if (this.activeTab === tab) return\r\n      this.activeTab = tab\r\n      this.orderList = []\r\n      this.loadOrders()\r\n    },\r\n\r\n    loadOrders(cb) {\r\n      this.loading = true\r\n      const token = uni.getStorageSync('token')\r\n      if (!token) return\r\n\r\n      uni.request({\r\n        url: 'http://192.168.0.105:8080/api/order/my',\r\n        data: { status: this.activeTab }, // 传 null 就是全部\r\n        header: { Authorization: 'Bearer ' + token },\r\n        success: (res) => {\r\n          if (res.statusCode === 200 && res.data.list) {\r\n            this.orderList = res.data.list.map(item => {\r\n              try {\r\n                const images = typeof item.goodsImages === 'string' ? JSON.parse(item.goodsImages) : item.goodsImages\r\n                item.cover = Array.isArray(images) && images.length ? images[0] : '/static/default-cover.png'\r\n              } catch {\r\n                item.cover = '/static/default-cover.png'\r\n              }\r\n              return item\r\n            })\r\n          }\r\n        },\r\n        complete: () => {\r\n          this.loading = false\r\n          cb && cb()\r\n        }\r\n      })\r\n    },\r\n\r\n    getStatusClass(status) {\r\n      const map = {\r\n        0: 'warning',   // 橙色\r\n        1: 'primary',   // 蓝色\r\n        2: 'waiting',\t// 黄色\r\n        3: 'success',   // 绿色\r\n        4: 'refund',    // 紫色\r\n        5: 'default'    // 灰色\r\n      }\r\n      return map[status] || 'default'\r\n    },\r\n\r\n    toDetail(id) {\r\n      uni.navigateTo({ url: `/pages/order/detail?id=${id}` })\r\n    },\r\n\r\n    pay(id) {\r\n      uni.showToast({ title: '即将跳转微信支付', icon: 'none' })\r\n    },\r\n\r\n    confirmReceive(id) {\r\n      uni.showModal({\r\n        title: '确认收货',\r\n        content: '已收到商品？',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            const token = uni.getStorageSync('token')\r\n            uni.request({\r\n              url: `http://192.168.0.105:8080/api/order/status/${id}?newStatus=3`,\r\n              method: 'PUT',\r\n              header: { Authorization: 'Bearer ' + token },\r\n              success: () => {\r\n                uni.showToast({ title: '确认收货成功' })\r\n                this.loadOrders()\r\n              }\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n\r\n    contactSeller() {\r\n      uni.showToast({ title: '已通知客服处理退款', icon: 'success' })\r\n    },\r\n\r\n\tgoBack() {\r\n\t  const pages = getCurrentPages()\r\n\t  if (pages.length > 1) {\r\n\t\t// 有上一页 → 正常返回\r\n\t\tuni.navigateBack()\r\n\t  } else {\r\n\t\t// 没有上一页 → 跳转到“我的”页面（或首页）\r\n\t\tuni.switchTab({ url: '/pages/mine/mine' })\r\n\t\t// 如果你想回首页，改成：'/pages/index/index'\r\n\t  }\r\n\t},\r\n\r\n    toHome() {\r\n      uni.switchTab({ url: '/pages/index/index' })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.orders-page { background: #f8f8f8; min-height: 100vh; }\r\n\r\n/* 顶部导航栏 */\r\n.nav-bar {\r\n  height: 88rpx; background: #fff; display: flex; align-items: center;\r\n  justify-content: space-between; padding: 0 32rpx; position: sticky; top: 0; z-index: 100;\r\n  box-shadow: 0 2rpx 10rpx rgba(0,0,0,0.05);\r\n}\r\n.nav-bar .title { font-size: 36rpx; font-weight: bold; color: #333; position: absolute; left: 50%; transform: translateX(-50%); }\r\n\r\n/* 6个Tab */\r\n.tabs {\r\n  display: flex; background: #fff; position: sticky; top: 88rpx; z-index: 99;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n}\r\n.tab-item {\r\n  flex: 1; text-align: center; padding: 30rpx 0; font-size: 30rpx; color: #666;\r\n}\r\n.tab-item.active {\r\n  color: #ff4757; font-weight: bold; position: relative;\r\n}\r\n.tab-item.active::after {\r\n  content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);\r\n  width: 60rpx; height: 6rpx; background: #ff4757; border-radius: 3rpx;\r\n}\r\n\r\n.order-list { height: calc(100vh - 176rpx); }\r\n.order-item { background: #fff; margin: 20rpx; border-radius: 24rpx; padding: 32rpx; box-shadow: 0 4rpx 20rpx rgba(0,0,0,0.05); }\r\n.goods-info { display: flex; }\r\n.cover { width: 180rpx; height: 180rpx; border-radius: 20rpx; }\r\n.details { margin-left: 24rpx; flex: 1; }\r\n.title { font-size: 32rpx; color: #333; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }\r\n.price { font-size: 30rpx; color: #ff4757; margin-top: 12rpx; font-weight: bold; }\r\n\r\n.footer { display: flex; justify-content: space-between; align-items: center; margin-top: 32rpx; padding-top: 32rpx; border-top: 1rpx solid #f0f0f0; }\r\n.status { font-size: 28rpx; padding: 8rpx 20rpx; border-radius: 8rpx; }\r\n.status.warning { background: #fff2e8; color: #d4380d; }\r\n.status.primary { background: #e6f7ff; color: #1890ff; }\r\n.status.waiting { background: #e6f7ff; color: #FFAE42; }\r\n.status.success { background: #f6ffed; color: #52c41a; }\r\n.status.refund { background: #f9f0ff; color: #722ed1; }\r\n.status.default { background: #f5f5f5; color: #999; }\r\n\r\n.actions .btn { font-size: 28rpx; padding: 12rpx 32rpx; border-radius: 50rpx; }\r\n.btn.pay { background: #ff4757; color: #fff; }\r\n.btn.confirm { background: #fff; color: #ff4757; border: 2rpx solid #ff4757; }\r\n.btn.refund { background: #722ed1; color: #fff; }\r\n.btn.plain { background: #f5f5f5; color: #666; }\r\n\r\n.empty { text-align: center; padding-top: 200rpx; color: #999; }\r\n.empty-img { width: 400rpx; }\r\n.go-shop { margin-top: 40rpx; background: #ff4757; color: #fff; width: 400rpx; height: 88rpx; line-height: 88rpx; border-radius: 88rpx; }\r\n.loading { text-align: center; padding: 60rpx; color: #999; }\r\n</style>","import MiniProgramPage from 'E:/code/wechatDOC/HbUniapp/demoxiaoyuan/pages/mine/my-orders.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}