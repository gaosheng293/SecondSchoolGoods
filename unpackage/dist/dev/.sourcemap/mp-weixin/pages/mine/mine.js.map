{"version":3,"file":"mine.js","sources":["pages/mine/mine.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWluZS9taW5lLnZ1ZQ"],"sourcesContent":["<template>\r\n  <view class=\"page\">\r\n    <!-- 加载中 -->\r\n    <view v-if=\"loading\" class=\"loading-box\">\r\n      <uni-icons type=\"spinner\" size=\"40\" color=\"#007AFF\" spin />\r\n      <text class=\"loading-text\">加载中...</text>\r\n    </view>\r\n\r\n    <!-- 加载失败 -->\r\n    <view v-else-if=\"error\" class=\"error-box\" @click=\"loadProfile\">\r\n      <uni-icons type=\"refresh\" size=\"40\" color=\"#999\" />\r\n      <text class=\"error-text\">{{ error }}</text>\r\n      <text class=\"retry-text\">点击重新加载</text>\r\n    </view>\r\n\r\n    <!-- 已登录 --> \r\n    <view v-else-if=\"isLogin && profile\" class=\"content\">\r\n      <!-- 顶部背景 + 头像区 -->\r\n      <view class=\"header-bg\">\r\n        <view class=\"header\">\r\n          <view class=\"avatar-box\" @click=\"toEditProfile\">\r\n            <image :src=\"profile?.avatar || '/static/c1.png'\" mode=\"aspectFill\" class=\"avatar\" />\r\n          </view>\r\n\r\n          <view class=\"user-info\">\r\n            <text class=\"nickname\">{{ profile?.nickname || '未设置昵称' }}</text>\r\n            <view class=\"school-tag\" v-if=\"profile.university\">\r\n              <uni-icons type=\"location-filled\" size=\"14\" color=\"#007AFF\" />\r\n              <text>{{ profile.university.name }}</text>\r\n            </view>\r\n          </view>\r\n\r\n          <view class=\"edit-btn\" @click=\"toEditProfile\">\r\n            <uni-icons type=\"gear\" size=\"20\" color=\"#999\" />\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 资产卡片 -->\r\n      <view class=\"assets-card\">\r\n        <view class=\"assets-item\" @click=\"toMyGoods\">\r\n          <text class=\"num\">{{ profile.goodsCount || 0 }}</text>\r\n          <text class=\"label\">我的闲置</text>\r\n        </view>\r\n        <view class=\"divider\"></view>\r\n        <view class=\"assets-item\" @click=\"toMyOrders\">\r\n          <text class=\"num\">{{ profile.orderCount || 0 }}</text>\r\n          <text class=\"label\">我的订单</text>\r\n        </view>\r\n        <view class=\"divider\"></view>\r\n        <view class=\"assets-item\" @click=\"toMyLikes\">\r\n          <text class=\"num\">{{ profile.likeCount || 0 }}</text>\r\n          <text class=\"label\">我的喜欢</text>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 功能列表 -->\r\n      <view class=\"menu-list\">\r\n        <view class=\"menu-item\" @click=\"toAddress\">\r\n          <uni-icons type=\"map\" size=\"20\" color=\"#007AFF\" />\r\n          <text>收货地址</text>\r\n          <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\" />\r\n        </view>\r\n        <view class=\"menu-item\" @click=\"toPublishHistory\">\r\n          <uni-icons type=\"compose\" size=\"20\" color=\"#4CD964\" />\r\n          <text>发布记录</text>\r\n          <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\" />\r\n        </view>\r\n        <view class=\"menu-item\" @click=\"toHelp\">\r\n          <uni-icons type=\"help\" size=\"20\" color=\"#FFB800\" />\r\n          <text>帮助与反馈</text>\r\n          <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\" />\r\n        </view>\r\n        <view class=\"menu-item\" @click=\"toAbout\">\r\n          <uni-icons type=\"info\" size=\"20\" color=\"#666\" />\r\n          <text>关于我们</text>\r\n          <uni-icons type=\"arrowright\" size=\"16\" color=\"#ccc\" />\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 退出登录 -->\r\n      <view class=\"logout-box\">\r\n        <button class=\"logout-btn\" @click=\"handleLogout\">退出登录</button>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 未登录状态 -->\r\n    <view v-else class=\"not-login\" @click=\"toLogin\">\r\n      <image src=\"/static/c1.png\" mode=\"widthFix\" class=\"not-login-img\" />\r\n      <text class=\"not-login-text\">点击登录，解锁完整功能</text>\r\n    </view>\r\n\r\n    <!-- 底部安全区 -->\r\n     <!-- 自定义 tabBar（必须放在最后）-->\r\n    <!-- <custom-tab-bar :index=\"3\" /> -->\r\n  </view>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted } from 'vue'\r\nimport { onLoad, onShow, onHide } from '@dcloudio/uni-app'  // 正确！必须这样写\r\n\r\n// 响应式状态\r\nconst loading = ref(true)\r\nconst error = ref('')\r\nconst profile = ref(null)\r\nconst isLogin = ref(false)\r\n\r\n// 获取用户信息（真实接口）\r\nconst loadProfile = async () => {\r\n  loading.value = true\r\n  error.value = ''\r\n  \r\n  const token = uni.getStorageSync('token')\r\n  if (!token) {\r\n    loading.value = false\r\n    isLogin.value = false\r\n    return\r\n  }\r\n\r\n  uni.request({\r\n    url: 'http://192.168.0.105:8080/api/user/mine',  // 改成 /mine，因为它返回 counts\r\n    method: 'GET',\r\n    header: {\r\n      'Authorization': 'Bearer ' + token\r\n    },\r\n    success: (res) => {\r\n      if (res.statusCode === 200 && res.data) {\r\n        profile.value = res.data\r\n        isLogin.value = true\r\n      } else {\r\n        error.value = '数据格式错误'\r\n        isLogin.value = false\r\n      }\r\n    },\r\n    fail: (err) => {\r\n      console.error('获取用户信息失败', err)\r\n      error.value = err.errMsg.includes('timeout') ? '请求超时' : '网络错误，请检查后端'\r\n      isLogin.value = false\r\n    },\r\n    complete: () => {\r\n      loading.value = false\r\n    }\r\n  })\r\n}\r\n\r\n// 退出登录\r\nconst handleLogout = () => {\r\n  uni.showModal({\r\n    title: '确认退出登录？',\r\n    success: (res) => {\r\n      if (res.confirm) {\r\n        uni.removeStorageSync('token')\r\n        uni.reLaunch({ url: '/pages/login/login' })\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n// 页面跳转\r\nconst toLogin = () => uni.reLaunch({ url: '/pages/login/login' })\r\nconst toEditProfile = () => uni.navigateTo({ url: '/pages/profile/edit' })\r\nconst toMyGoods = () => uni.navigateTo({ url: '/pages/mine/my-goods' })\r\nconst toMyOrders = () => uni.navigateTo({ url: '/pages/mine/my-orders' })\r\nconst toMyLikes = () => uni.navigateTo({ url: '/pages/mine/my-likes' })\r\nconst toAddress = () => uni.navigateTo({ url: '/pages/address/list' })\r\nconst toPublishHistory = () => uni.navigateTo({ url: '/pages/publish/history' })\r\nconst toHelp = () => uni.navigateTo({ url: '/pages/help/help' })\r\nconst toAbout = () => uni.navigateTo({ url: '/pages/about/about' })\r\n\r\n// 生命周期\r\nonLoad(() => {\r\n  loadProfile()\r\n})\r\n\r\nonShow(() => {\r\n  // 每次显示都刷新（比如从编辑资料回来）\r\n  if (uni.getStorageSync('token')) {\r\n    loadProfile()\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.page { min-height: 100vh; background: #f5f5f5; }\r\n\r\n// 加载状态\r\n.loading-box, .error-box {\r\n  text-align: center; padding-top: 300rpx;\r\n}\r\n.loading-text, .error-text, .retry-text {\r\n  display: block; margin-top: 32rpx; font-size: 32rpx; color: #999;\r\n}\r\n.retry-text { color: #007AFF; margin-top: 20rpx; }\r\n\r\n// 未登录\r\n.not-login {\r\n  text-align: center; padding-top: 300rpx;\r\n}\r\n.not-login-img { width: 360rpx; }\r\n.not-login-text { font-size: 36rpx; color: #333; margin-top: 60rpx; }\r\n\r\n// 其余样式和之前美化版完全一致（省略重复，保持一致）\r\n.header-bg { height: 420rpx; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding-top: var(--status-bar-height); }\r\n.header { height: 320rpx; display: flex; align-items: center; padding: 0 40rpx; position: relative; }\r\n.avatar { width: 160rpx; height: 160rpx; border-radius: 50%; border: 8rpx solid rgba(255,255,255,0.3); background: #fff; }\r\n.user-info { margin-left: 32rpx; flex: 1; }\r\n.nickname { font-size: 48rpx; color: #fff; font-weight: bold; }\r\n.school-tag { margin-top: 12rpx; background: rgba(255,255,255,0.25); backdrop-filter: blur(10rpx); display: inline-flex; align-items: center; gap: 8rpx; padding: 8rpx 20rpx; border-radius: 40rpx; font-size: 26rpx; color: #fff; }\r\n.edit-btn { width: 80rpx; height: 80rpx; background: rgba(255,255,255,0.2); backdrop-filter: blur(10rpx); border-radius: 50%; display: flex; align-items: center; justify-content: center; }\r\n\r\n.assets-card { margin: -80rpx 32rpx 40rpx; background: #fff; border-radius: 32rpx; padding: 40rpx 0; display: flex; box-shadow: 0 10rpx 40rpx rgba(0,0,0,0.1); }\r\n.assets-item { flex: 1; text-align: center; }\r\n.num { font-size: 56rpx; font-weight: bold; color: #333; }\r\n.label { font-size: 28rpx; color: #666; margin-top: 8rpx; }\r\n.divider { width: 1rpx; background: #eee; }\r\n\r\n.menu-list { margin: 0 32rpx 40rpx; background: #fff; border-radius: 24rpx; overflow: hidden; box-shadow: 0 8rpx 30rpx rgba(0,0,0,0.06); }\r\n.menu-item { height: 120rpx; padding: 0 40rpx; display: flex; align-items: center; border-bottom: 1rpx solid #f5f5f5; }\r\n.menu-item:last-child { border-bottom: none; }\r\n.menu-item text { flex: 1; margin-left: 32rpx; font-size: 32rpx; color: #333; }\r\n.extra { font-size: 32rpx; color: #007AFF; margin-right: 16rpx; }\r\n\r\n.logout-box { margin: 0 32rpx 80rpx; }\r\n.logout-btn { background: #fff; color: #ff4757; border: 2rpx solid #ff4757; border-radius: 50rpx; height: 96rpx; line-height: 92rpx; font-size: 32rpx; }\r\n\r\n.tabbar-safe { height: 140rpx; }\r\n</style>","import MiniProgramPage from 'E:/code/wechatDOC/HbUniapp/demoxiaoyuan/pages/mine/mine.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","onLoad","onShow"],"mappings":";;;;;;;;;;;;;;AAuGA,UAAM,UAAUA,cAAG,IAAC,IAAI;AACxB,UAAM,QAAQA,cAAG,IAAC,EAAE;AACpB,UAAM,UAAUA,cAAG,IAAC,IAAI;AACxB,UAAM,UAAUA,cAAG,IAAC,KAAK;AAGzB,UAAM,cAAc,YAAY;AAC9B,cAAQ,QAAQ;AAChB,YAAM,QAAQ;AAEd,YAAM,QAAQC,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAI,CAAC,OAAO;AACV,gBAAQ,QAAQ;AAChB,gBAAQ,QAAQ;AAChB;AAAA,MACD;AAEDA,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK;AAAA;AAAA,QACL,QAAQ;AAAA,QACR,QAAQ;AAAA,UACN,iBAAiB,YAAY;AAAA,QAC9B;AAAA,QACD,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,eAAe,OAAO,IAAI,MAAM;AACtC,oBAAQ,QAAQ,IAAI;AACpB,oBAAQ,QAAQ;AAAA,UACxB,OAAa;AACL,kBAAM,QAAQ;AACd,oBAAQ,QAAQ;AAAA,UACjB;AAAA,QACF;AAAA,QACD,MAAM,CAAC,QAAQ;AACbA,wBAAAA,MAAc,MAAA,SAAA,8BAAA,YAAY,GAAG;AAC7B,gBAAM,QAAQ,IAAI,OAAO,SAAS,SAAS,IAAI,SAAS;AACxD,kBAAQ,QAAQ;AAAA,QACjB;AAAA,QACD,UAAU,MAAM;AACd,kBAAQ,QAAQ;AAAA,QACjB;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AACfA,0BAAG,MAAC,kBAAkB,OAAO;AAC7BA,0BAAAA,MAAI,SAAS,EAAE,KAAK,qBAAoB,CAAE;AAAA,UAC3C;AAAA,QACF;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,UAAU,MAAMA,cAAAA,MAAI,SAAS,EAAE,KAAK,qBAAoB,CAAE;AAChE,UAAM,gBAAgB,MAAMA,cAAAA,MAAI,WAAW,EAAE,KAAK,sBAAqB,CAAE;AACzE,UAAM,YAAY,MAAMA,cAAAA,MAAI,WAAW,EAAE,KAAK,uBAAsB,CAAE;AACtE,UAAM,aAAa,MAAMA,cAAAA,MAAI,WAAW,EAAE,KAAK,wBAAuB,CAAE;AACxE,UAAM,YAAY,MAAMA,cAAAA,MAAI,WAAW,EAAE,KAAK,uBAAsB,CAAE;AACtE,UAAM,YAAY,MAAMA,cAAAA,MAAI,WAAW,EAAE,KAAK,sBAAqB,CAAE;AACrE,UAAM,mBAAmB,MAAMA,cAAAA,MAAI,WAAW,EAAE,KAAK,yBAAwB,CAAE;AAC/E,UAAM,SAAS,MAAMA,cAAAA,MAAI,WAAW,EAAE,KAAK,mBAAkB,CAAE;AAC/D,UAAM,UAAU,MAAMA,cAAAA,MAAI,WAAW,EAAE,KAAK,qBAAoB,CAAE;AAGlEC,kBAAAA,OAAO,MAAM;AACX,kBAAa;AAAA,IACf,CAAC;AAEDC,kBAAAA,OAAO,MAAM;AAEX,UAAIF,cAAG,MAAC,eAAe,OAAO,GAAG;AAC/B,oBAAa;AAAA,MACd;AAAA,IACH,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnLD,GAAG,WAAW,eAAe;"}