{"version":3,"file":"my-likes.js","sources":["pages/mine/my-likes.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWluZS9teS1saWtlcy52dWU"],"sourcesContent":["<!-- pages/mine/my-goods.vue -->\r\n<template>\r\n\t<view class=\"my-goods-page\">\r\n\t\t<view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n\r\n\t\t<view class=\"goods-grid\" v-if=\"goodsList.length\">\r\n\t\t\t<view class=\"goods-item\" v-for=\"item in goodsList\" :key=\"item.id\" @click=\"toDetail(item.id)\">\r\n\t\t\t\t<image :src=\"item.cover || '/static/default-cover.png'\" mode=\"aspectFill\" class=\"cover\" />\r\n\t\t\t\t<view class=\"item-info\">\r\n\t\t\t\t\t<text class=\"title\">{{ item.title }}</text>\r\n\t\t\t\t\t<text class=\"price\">¥{{ item.price }}</text>\r\n\t\t\t\t\t<view class=\"status-tag\" v-if=\"pageType === 'history' && item.status === 2\">\r\n\t\t\t\t\t\t已下架\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<view class=\"empty\" v-else>\r\n\t\t\t<image src=\"/static/empty.png\" class=\"empty-img\" mode=\"widthFix\" />\r\n\t\t\t<text class=\"empty-text\">{{ emptyText }}</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tstatusBarHeight: 0,\r\n\t\t\tgoodsList: [],\r\n\t\t\tpageType: '' // goods | likes | history\r\n\t\t}\r\n\t},\r\n\r\n\tcomputed: {\r\n\t\temptyText() {\r\n\t\t\tconst map = {\r\n\t\t\t\tgoods: '你还没有发布闲置商品哦~',\r\n\t\t\t\tlikes: '你还没有喜欢的宝贝',\r\n\t\t\t\thistory: '你还没有发布过商品'\r\n\t\t\t}\r\n\t\t\treturn map[this.pageType] || '暂无数据'\r\n\t\t}\r\n\t},\r\n\r\n\tonLoad() {\r\n\t\tthis.statusBarHeight = uni.getSystemInfoSync().statusBarHeight\r\n\t\tthis.detectPageTypeAndLoad()\r\n\t},\r\n\r\n\tmethods: {\r\n\t\tdetectPageTypeAndLoad() {\r\n\t\t\tconst pages = getCurrentPages()\r\n\t\t\tconst route = pages[pages.length - 1].route\r\n\r\n\t\t\tif (route.includes('my-goods')) {\r\n\t\t\t\tthis.pageType = 'goods'\r\n\t\t\t\tthis.load('/api/goods/my')\r\n\t\t\t} else if (route.includes('my-likes')) {\r\n\t\t\t\tthis.pageType = 'likes'\r\n\t\t\t\tthis.load('/api/goods/my-likes')\r\n\t\t\t} else if (route.includes('publish/history')) {\r\n\t\t\t\tthis.pageType = 'history'\r\n\t\t\t\tthis.load('/api/goods/my-published')\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tload(api) {\r\n\t\t\tconst token = uni.getStorageSync('token')\r\n\t\t\tif (!token) {\r\n\t\t\t\tuni.showToast({ title: '请先登录', icon: 'none' })\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tuni.request({\r\n\t\t\t\turl: 'http://192.168.0.105:8080' + api,\r\n\t\t\t\theader: { Authorization: 'Bearer ' + token },\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (res.statusCode === 200 && res.data?.list) {\r\n\t\t\t\t\t\tthis.goodsList = this.processImages(res.data.list)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\tprocessImages(list) {\r\n\t\t\treturn list.map(item => {\r\n\t\t\t\t// 防御式处理 images\r\n\t\t\t\tif (!item.images) {\r\n\t\t\t\t\titem.images = []\r\n\t\t\t\t} else if (typeof item.images === 'string') {\r\n\t\t\t\t\ttry { item.images = JSON.parse(item.images) }\r\n\t\t\t\t\tcatch { item.images = item.images.split(',').map(s => s.trim()).filter(Boolean) }\r\n\t\t\t\t}\r\n\t\t\t\titem.cover = Array.isArray(item.images) && item.images.length\r\n\t\t\t\t\t? item.images[0]\r\n\t\t\t\t\t: '/static/default-cover.png'\r\n\t\t\t\treturn item\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\ttoDetail(id) {\r\n\t\t\tuni.redirectTo({ url: `/pages/detail/detail?id=${id}` })\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.my-goods-page { background: #f8f8f8; min-height: 100vh; padding: 20rpx; padding-bottom: 40rpx; }\r\n.goods-grid { display: flex; flex-wrap: wrap; justify-content: space-between; }\r\n.goods-item { width: calc(50% - 12rpx); background: #fff; border-radius: 20rpx; overflow: hidden; margin-bottom: 24rpx; position: relative; }\r\n.cover { width: 100%; height: 340rpx; background: #f5f5f5; }\r\n.item-info { padding: 16rpx; position: relative; }\r\n.title { font-size: 26rpx; color: #333; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-bottom: 8rpx; }\r\n.price { font-size: 32rpx; color: #ff4757; font-weight: bold; }\r\n.status-tag { position: absolute; top: 16rpx; right: 16rpx; background: rgba(0,0,0,0.6); color: #fff; font-size: 22rpx; padding: 4rpx 12rpx; border-radius: 8rpx; }\r\n.empty { text-align: center; padding-top: 180rpx; color: #999; }\r\n.empty-img { width: 360rpx; margin-bottom: 40rpx; }\r\n.empty-text { font-size: 30rpx; }\r\n</style>","import MiniProgramPage from 'E:/code/wechatDOC/HbUniapp/demoxiaoyuan/pages/mine/my-likes.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;;AA0BA,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,iBAAiB;AAAA,MACjB,WAAW,CAAE;AAAA,MACb,UAAU;AAAA;AAAA,IACX;AAAA,EACA;AAAA,EAED,UAAU;AAAA,IACT,YAAY;AACX,YAAM,MAAM;AAAA,QACX,OAAO;AAAA,QACP,OAAO;AAAA,QACP,SAAS;AAAA,MACV;AACA,aAAO,IAAI,KAAK,QAAQ,KAAK;AAAA,IAC9B;AAAA,EACA;AAAA,EAED,SAAS;AACR,SAAK,kBAAkBA,oBAAI,kBAAmB,EAAC;AAC/C,SAAK,sBAAsB;AAAA,EAC3B;AAAA,EAED,SAAS;AAAA,IACR,wBAAwB;AACvB,YAAM,QAAQ,gBAAgB;AAC9B,YAAM,QAAQ,MAAM,MAAM,SAAS,CAAC,EAAE;AAEtC,UAAI,MAAM,SAAS,UAAU,GAAG;AAC/B,aAAK,WAAW;AAChB,aAAK,KAAK,eAAe;AAAA,MAC1B,WAAW,MAAM,SAAS,UAAU,GAAG;AACtC,aAAK,WAAW;AAChB,aAAK,KAAK,qBAAqB;AAAA,MAChC,WAAW,MAAM,SAAS,iBAAiB,GAAG;AAC7C,aAAK,WAAW;AAChB,aAAK,KAAK,yBAAyB;AAAA,MACpC;AAAA,IACA;AAAA,IAED,KAAK,KAAK;AACT,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAI,CAAC,OAAO;AACXA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAC7C;AAAA,MACD;AAEAA,oBAAAA,MAAI,QAAQ;AAAA,QACX,KAAK,8BAA8B;AAAA,QACnC,QAAQ,EAAE,eAAe,YAAY,MAAO;AAAA,QAC5C,SAAS,CAAC,QAAQ;;AACjB,cAAI,IAAI,eAAe,SAAO,SAAI,SAAJ,mBAAU,OAAM;AAC7C,iBAAK,YAAY,KAAK,cAAc,IAAI,KAAK,IAAI;AAAA,UAClD;AAAA,QACD;AAAA,OACA;AAAA,IACD;AAAA,IAED,cAAc,MAAM;AACnB,aAAO,KAAK,IAAI,UAAQ;AAEvB,YAAI,CAAC,KAAK,QAAQ;AACjB,eAAK,SAAS,CAAC;AAAA,QAChB,WAAW,OAAO,KAAK,WAAW,UAAU;AAC3C,cAAI;AAAE,iBAAK,SAAS,KAAK,MAAM,KAAK,MAAM;AAAA,UAAE,QACtC;AAAE,iBAAK,SAAS,KAAK,OAAO,MAAM,GAAG,EAAE,IAAI,OAAK,EAAE,KAAM,CAAA,EAAE,OAAO,OAAO;AAAA,UAAE;AAAA,QACjF;AACA,aAAK,QAAQ,MAAM,QAAQ,KAAK,MAAM,KAAK,KAAK,OAAO,SACpD,KAAK,OAAO,CAAC,IACb;AACH,eAAO;AAAA,OACP;AAAA,IACD;AAAA,IAED,SAAS,IAAI;AACZA,oBAAG,MAAC,WAAW,EAAE,KAAK,2BAA2B,EAAE,IAAI;AAAA,IACxD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;ACzGA,GAAG,WAAW,eAAe;"}