{"version":3,"file":"edit.js","sources":["pages/publish/edit.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHVibGlzaC9lZGl0LnZ1ZQ"],"sourcesContent":["<!-- pages/publish/edit.vue -->\r\n<template>\r\n  <view class=\"edit-page\">\r\n    <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n\r\n    <view class=\"form\">\r\n      <view class=\"form-item\">\r\n        <text class=\"label\">商品标题</text>\r\n        <input v-model=\"goods.title\" placeholder=\"请输入标题\" />\r\n      </view>\r\n      <view class=\"form-item\">\r\n        <text class=\"label\">价格</text>\r\n        <input v-model.number=\"goods.price\" type=\"digit\" placeholder=\"0.00\" />\r\n      </view>\r\n      <view class=\"form-item\">\r\n        <text class=\"label\">商品描述</text>\r\n        <textarea v-model=\"goods.description\" placeholder=\"描述一下商品状况、新旧程度等\" />\r\n      </view>\r\n\r\n      <!-- 图片上传区域（可复用你原来的发布页逻辑） -->\r\n      <view class=\"upload-box\">\r\n        <text class=\"label\">商品图片（最多9张）</text>\r\n        <view class=\"image-grid\">\r\n          <view v-for=\"(img, i) in goods.images\" :key=\"i\" class=\"image-item\">\r\n            <image :src=\"img\" mode=\"aspectFill\" />\r\n            <view class=\"delete\" @click=\"removeImage(i)\">\r\n              <uni-icons type=\"close\" size=\"20\" color=\"#fff\" />\r\n            </view>\r\n          </view>\r\n          <view class=\"add-btn\" v-if=\"goods.images.length < 9\" @click=\"chooseImage\">\r\n            <uni-icons type=\"plus\" size=\"40\" color=\"#ccc\" />\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <button class=\"save-btn\" @click=\"save\">保存修改</button>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      statusBarHeight: 0,\r\n      goods: {\r\n        id: null,\r\n        title: '',\r\n        price: 0,\r\n        description: '',\r\n        images: []\r\n      }\r\n    }\r\n  },\r\n\r\n  onLoad(options) {\r\n    this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight\r\n    if (options.id) {\r\n      this.goods.id = options.id\r\n      this.loadGoods()\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    loadGoods() {\r\n      const token = uni.getStorageSync('token')\r\n      uni.request({\r\n        url: `http://192.168.0.105:8080/api/goods/detail/${this.goods.id}`,\r\n        header: { Authorization: 'Bearer ' + token },\r\n        success: (res) => {\r\n          if (res.statusCode === 200 && res.data) {\r\n            const g = res.data\r\n            // 处理图片\r\n            if (typeof g.images === 'string') {\r\n              try { g.images = JSON.parse(g.images) }\r\n              catch { g.images = g.images.split(',').filter(Boolean) }\r\n            }\r\n            this.goods = g\r\n          }\r\n        }\r\n      })\r\n    },\r\n\r\n    chooseImage() {\r\n      uni.chooseImage({\r\n        count: 9 - this.goods.images.length,\r\n        success: (res) => {\r\n          const tempFiles = res.tempFilePaths\r\n          // 上传图片（你已有上传逻辑，这里简化为直接存路径，实际应上传到服务器）\r\n          this.goods.images = [...this.goods.images, ...tempFiles]\r\n        }\r\n      })\r\n    },\r\n\r\n    removeImage(i) {\r\n      this.goods.images.splice(i, 1)\r\n    },\r\n\r\n\tsave() {\r\n\t  if (!this.goods.title || !this.goods.price) {\r\n\t\treturn uni.showToast({ title: '请填写完整', icon: 'none' })\r\n\t  }\r\n\r\n\t  // 关键：保存前把 images 数组转成 JSON 字符串\r\n\t  const data = {\r\n\t\t...this.goods,\r\n\t\timages: JSON.stringify(this.goods.images)  // ← 重点！\r\n\t  }\r\n\r\n\t  const token = uni.getStorageSync('token')\r\n\t  uni.request({\r\n\t\turl: 'http://192.168.0.105:8080/api/goods/update',\r\n\t\tmethod: 'POST',\r\n\t\theader: { \r\n\t\t  'Authorization': 'Bearer ' + token,\r\n\t\t  'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tdata: data,\r\n\t\tsuccess: (res) => {\r\n\t\t  if (res.data.ok) {\r\n\t\t\tuni.showToast({ title: '修改成功' })\r\n\t\t\tsetTimeout(() => uni.navigateBack(), 1000)\r\n\t\t  }\r\n\t\t}\r\n\t  })\r\n\t}\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.edit-page { background: #f8f8f8; min-height: 100vh; padding-bottom: 120rpx; }\r\n.form { background: #fff; }\r\n.form-item { padding: 32rpx; border-bottom: 1rpx solid #eee; }\r\n.label { display: block; font-size: 32rpx; color: #333; margin-bottom: 20rpx; }\r\ninput, textarea { font-size: 32rpx; color: #666; }\r\ntextarea { height: 300rpx; }\r\n\r\n.upload-box { padding: 32rpx; }\r\n.image-grid { display: flex; flex-wrap: wrap; gap: 20rpx; margin-top: 20rpx; }\r\n.image-item { position: relative; width: 200rpx; height: 200rpx; }\r\n.image-item image { width: 100%; height: 100%; border-radius: 16rpx; }\r\n.delete { position: absolute; top: 8rpx; right: 8rpx; background: rgba(0,0,0,0.6); border-radius: 50%; padding: 4rpx; }\r\n.add-btn { width: 200rpx; height: 200rpx; background: #f5f5f5; border-radius: 16rpx; display: flex; align-items: center; justify-content: center; }\r\n\r\n.save-btn { margin: 40rpx 32rpx; background: #ff4757; color: #fff; height: 88rpx; line-height: 88rpx; border-radius: 88rpx; font-size: 34rpx; }\r\n</style>","import MiniProgramPage from 'E:/code/wechatDOC/HbUniapp/demoxiaoyuan/pages/publish/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAyCA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,iBAAiB;AAAA,MACjB,OAAO;AAAA,QACL,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,OAAO;AAAA,QACP,aAAa;AAAA,QACb,QAAQ,CAAC;AAAA,MACX;AAAA,IACF;AAAA,EACD;AAAA,EAED,OAAO,SAAS;AACd,SAAK,kBAAkBA,oBAAI,kBAAmB,EAAC;AAC/C,QAAI,QAAQ,IAAI;AACd,WAAK,MAAM,KAAK,QAAQ;AACxB,WAAK,UAAU;AAAA,IACjB;AAAA,EACD;AAAA,EAED,SAAS;AAAA,IACP,YAAY;AACV,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxCA,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK,8CAA8C,KAAK,MAAM,EAAE;AAAA,QAChE,QAAQ,EAAE,eAAe,YAAY,MAAO;AAAA,QAC5C,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,eAAe,OAAO,IAAI,MAAM;AACtC,kBAAM,IAAI,IAAI;AAEd,gBAAI,OAAO,EAAE,WAAW,UAAU;AAChC,kBAAI;AAAE,kBAAE,SAAS,KAAK,MAAM,EAAE,MAAM;AAAA,cAAE,QAChC;AAAE,kBAAE,SAAS,EAAE,OAAO,MAAM,GAAG,EAAE,OAAO,OAAO;AAAA,cAAE;AAAA,YACzD;AACA,iBAAK,QAAQ;AAAA,UACf;AAAA,QACF;AAAA,OACD;AAAA,IACF;AAAA,IAED,cAAc;AACZA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO,IAAI,KAAK,MAAM,OAAO;AAAA,QAC7B,SAAS,CAAC,QAAQ;AAChB,gBAAM,YAAY,IAAI;AAEtB,eAAK,MAAM,SAAS,CAAC,GAAG,KAAK,MAAM,QAAQ,GAAG,SAAS;AAAA,QACzD;AAAA,OACD;AAAA,IACF;AAAA,IAED,YAAY,GAAG;AACb,WAAK,MAAM,OAAO,OAAO,GAAG,CAAC;AAAA,IAC9B;AAAA,IAEJ,OAAO;AACL,UAAI,CAAC,KAAK,MAAM,SAAS,CAAC,KAAK,MAAM,OAAO;AAC7C,eAAOA,cAAAA,MAAI,UAAU,EAAE,OAAO,SAAS,MAAM,QAAQ;AAAA,MACpD;AAGA,YAAM,OAAO;AAAA,QACd,GAAG,KAAK;AAAA,QACR,QAAQ,KAAK,UAAU,KAAK,MAAM,MAAM;AAAA;AAAA,MACvC;AAEA,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxCA,oBAAAA,MAAI,QAAQ;AAAA,QACb,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,QAAQ;AAAA,UACN,iBAAiB,YAAY;AAAA,UAC7B,gBAAgB;AAAA,QACjB;AAAA,QACD;AAAA,QACA,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,KAAK,IAAI;AAClBA,0BAAAA,MAAI,UAAU,EAAE,OAAO,OAAK,CAAG;AAC/B,uBAAW,MAAMA,cAAAA,MAAI,aAAY,GAAI,GAAI;AAAA,UACxC;AAAA,QACF;AAAA,OACE;AAAA,IACH;AAAA,EACC;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9HA,GAAG,WAAW,eAAe;"}