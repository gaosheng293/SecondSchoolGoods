{"version":3,"file":"home.js","sources":["pages/user/home.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9ob21lLnZ1ZQ"],"sourcesContent":["<!-- pages/user/home.vue -->\r\n<template>\r\n\t<view class=\"user-home-page\">\r\n\t\t<!-- 顶部状态栏占位 -->\r\n\t\t<view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n\r\n\t\t<!-- 用户信息卡片 -->\r\n\t\t<view class=\"user-card\">\r\n\t\t\t<image :src=\"userInfo.avatar || '/static/default-avatar.png'\" class=\"avatar\" mode=\"aspectFill\" />\r\n\t\t\t<view class=\"info\">\r\n\t\t\t\t<text class=\"nickname\">{{ userInfo.nickname || '匿名用户' }}</text>\r\n\t\t\t\t<text class=\"school\">{{ userInfo.universityName || '暂未设置学校' }}</text>\r\n\t\t\t\t<view class=\"stats\">\r\n\t\t\t\t\t<view class=\"stat-item\">\r\n\t\t\t\t\t\t<text class=\"num\">{{ userInfo.goodsCount || 0 }}</text>\r\n\t\t\t\t\t\t<text class=\"label\">商品</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\t\t</view>\r\n\r\n\t\t<!-- Tab 切换 -->\r\n\t\t<view class=\"tabs\">\r\n\t\t\t<view class=\"tab-item\" :class=\"{ active: activeTab === 0 }\" @click=\"activeTab = 0\">\r\n\t\t\t\t淘的宝贝（{{ goodsList.length }}）\r\n\t\t\t</view>\r\n\t\t\t<view class=\"tab-item\" :class=\"{ active: activeTab === 1 }\" @click=\"activeTab = 1\">\r\n\t\t\t\t我喜欢的（{{ likeList.length }}）\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 商品列表（网格） -->\r\n\t\t<view class=\"goods-grid\" v-if=\"showList.length\">\r\n\t\t\t<view class=\"goods-item\" v-for=\"item in showList\" :key=\"item.id\" @click=\"toDetail(item.id)\">\r\n\t\t\t\t<image :src=\"item.cover || item.images[0]\" mode=\"aspectFill\" class=\"cover\" />\r\n\t\t\t\t<view class=\"item-info\">\r\n\t\t\t\t\t<text class=\"title\">{{ item.title }}</text>\r\n\t\t\t\t\t<text class=\"price\">¥{{ item.price }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 空状态 -->\r\n\t\t<view class=\"empty\" v-else>\r\n\t\t\t<image src=\"/static/empty.png\" class=\"empty-img\" mode=\"widthFix\" />\r\n\t\t\t<text class=\"empty-text\">{{ activeTab === 0 ? 'Ta 还没有发布商品哦~' : 'Ta 还没有喜欢的商品' }}</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tuserId: 0,              // 目标用户 id\r\n\t\t\tisMyself: false,        // 是否是自己的主页\r\n\t\t\thasLogin: false,        // 当前是否已登录\r\n\t\t\tstatusBarHeight: 0,\r\n\t\t\tactiveTab: 0,           // 0=发布的商品 1=喜欢的商品\r\n\r\n\t\t\tuserInfo: {},           // 用户信息\r\n\t\t\tgoodsList: [],          // 发布的商品\r\n\t\t\tlikeList: []            // 喜欢的商品\r\n\t\t}\r\n\t},\r\n\r\n\tcomputed: {\r\n\t\tshowList() {\r\n\t\t\treturn this.activeTab === 0 ? this.goodsList : this.likeList\r\n\t\t}\r\n\t},\r\n\r\n\tonLoad(options) {\r\n\t\tthis.userId = Number(options.userId) || 0\r\n\t\tthis.statusBarHeight = uni.getSystemInfoSync().statusBarHeight\r\n\t\t\r\n\t\tconst token = uni.getStorageSync('token')\r\n\t\tthis.hasLogin = !!token\r\n\t\t\r\n\t\t// 判断是不是自己\r\n\t\tif (token) {\r\n\t\t\tconst myInfo = uni.getStorageSync('userInfo') || {}\r\n\t\t\tthis.isMyself = myInfo.id === this.userId\r\n\t\t}\r\n\r\n\t\tthis.loadUserInfo()\r\n\t\tthis.loadGoods()\r\n\t\tthis.loadLikes()\r\n\t},\r\n\r\n\tmethods: {\r\n\t\t// 加载用户信息\r\n\t\tasync loadUserInfo() {\r\n\t\t\tconst token = uni.getStorageSync('token')\r\n\t\t\tuni.request({\r\n\t\t\t\turl: `http://192.168.0.105:8080/api/user/info/${this.userId}`,\r\n\t\t\t\theader: token ? { Authorization: 'Bearer ' + token } : {},\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (res.statusCode === 200 && res.data) {\r\n\t\t\t\t\t\tthis.userInfo = res.data\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\r\n\t\t// 加载发布的商品\r\n\t\tasync loadGoods() {\r\n\t\t    uni.request({\r\n\t\t        url: `http://192.168.0.105:8080/api/user/goods/${this.userId}`,\r\n\t\t        success: (res) => {\r\n\t\t            if (res.statusCode === 200 && res.data?.list) {\r\n\t\t                let list = res.data.list\r\n\t\t                list.forEach(item => {\r\n\t\t                    // 关键修复：防止 images 是 null\r\n\t\t                    if (item.images === null || item.images === undefined) {\r\n\t\t                        item.images = []\r\n\t\t                    } else if (typeof item.images === 'string') {\r\n\t\t                        try {\r\n\t\t                            item.images = JSON.parse(item.images)\r\n\t\t                        } catch {\r\n\t\t                            item.images = item.images.split(',').map(s => s.trim()).filter(Boolean)\r\n\t\t                        }\r\n\t\t                    }\r\n\t\t                    // 确保是数组后再取第一张\r\n\t\t                    item.cover = Array.isArray(item.images) && item.images.length > 0 \r\n\t\t                        ? item.images[0] \r\n\t\t                        : '/static/default-cover.png'  // 建议准备一张默认图\r\n\t\t                })\r\n\t\t                this.goodsList = list\r\n\t\t            }\r\n\t\t        }\r\n\t\t    })\r\n\t\t},\r\n\t\t\r\n\t\t// 加载喜欢的商品（同理）\r\n\t\tasync loadLikes() {\r\n\t\t    if (!this.hasLogin && !this.isMyself) {\r\n\t\t        this.likeList = []\r\n\t\t        return\r\n\t\t    }\r\n\t\t\r\n\t\t    const token = uni.getStorageSync('token')\r\n\t\t    uni.request({\r\n\t\t        url: `http://192.168.0.105:8080/api/user/likes/${this.userId}`,\r\n\t\t        header: { Authorization: 'Bearer ' + token },\r\n\t\t        success: (res) => {\r\n\t\t            if (res.statusCode === 200 && res.data?.list) {\r\n\t\t                let list = res.data.list\r\n\t\t                list.forEach(item => {\r\n\t\t                    if (item.images === null || item.images === undefined) {\r\n\t\t                        item.images = []\r\n\t\t                    } else if (typeof item.images === 'string') {\r\n\t\t                        try {\r\n\t\t                            item.images = JSON.parse(item.images)\r\n\t\t                        } catch {\r\n\t\t                            item.images = item.images.split(',').map(s => s.trim()).filter(Boolean)\r\n\t\t                        }\r\n\t\t                    }\r\n\t\t                    item.cover = Array.isArray(item.images) && item.images.length > 0 \r\n\t\t                        ? item.images[0] \r\n\t\t                        : '/static/default-cover.png'\r\n\t\t                })\r\n\t\t                this.likeList = list\r\n\t\t            }\r\n\t\t        }\r\n\t\t    })\r\n\t\t},\r\n\r\n\r\n\t\ttoDetail(id) {\r\n\t\t\tuni.redirectTo({\r\n\t\t\t\turl: `/pages/detail/detail?id=${id}`\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.user-home-page { background: #f8f8f8; min-height: 100vh; padding-bottom: 40rpx; }\r\n\r\n.user-card {\r\n\tbackground: #fff; padding: 60rpx 32rpx; display: flex; align-items: center;\r\n\tposition: relative;\r\n}\r\n.avatar { width: 160rpx; height: 160rpx; border-radius: 50%; margin-right: 32rpx; }\r\n.info { flex: 1; }\r\n.nickname { font-size: 40rpx; font-weight: bold; color: #333; }\r\n.school { font-size: 28rpx; color: #999; margin-top: 12rpx; display: block; }\r\n.stats { display: flex; margin-top: 32rpx; }\r\n.stat-item { text-align: center; margin-right: 60rpx; }\r\n.stat-item .num { font-size: 36rpx; font-weight: bold; color: #333; display: block; }\r\n.stat-item .label { font-size: 24rpx; color: #999; }\r\n\r\n.follow-btn {\r\n\tposition: absolute; right: 32rpx; top: 50%; transform: translateY(-50%);\r\n\theight: 64rpx; line-height: 64rpx; padding: 0 32rpx;\r\n\tborder-radius: 64rpx; font-size: 28rpx;\r\n\tbackground: #ff4757; color: #fff;\r\n}\r\n.follow-btn.followed {\r\n\tbackground: #eee; color: #666;\r\n}\r\n\r\n.tabs {\r\n\tdisplay: flex; background: #fff; margin-top: 20rpx;\r\n}\r\n.tab-item {\r\n\tflex: 1; text-align: center; padding: 32rpx 0; font-size: 32rpx; color: #666;\r\n\tposition: relative;\r\n}\r\n.tab-item.active {\r\n\tcolor: #ff4757; font-weight: bold;\r\n}\r\n.tab-item.active::after {\r\n\tcontent: ''; position: absolute; bottom: 0; left: 50%;\r\n\ttransform: translateX(-50%); width: 80rpx; height: 6rpx;\r\n\tbackground: #ff4757; border-radius: 3rpx;\r\n}\r\n\r\n.goods-grid {\r\n\tdisplay: flex; flex-wrap: wrap; padding: 20rpx;\r\n}\r\n.goods-item {\r\n\twidth: calc(50% - 12rpx); background: #fff; border-radius: 20rpx;\r\n\toverflow: hidden; margin: 12rpx 6rpx;\r\n}\r\n.cover { width: 100%; height: 340rpx; }\r\n.item-info { padding: 16rpx; }\r\n.item-info .title {\r\n\tfont-size: 26rpx; color: #333; display: -webkit-box;\r\n\t-webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;\r\n\tmargin-bottom: 8rpx;\r\n}\r\n.item-info .price { font-size: 32rpx; color: #ff4757; font-weight: bold; }\r\n\r\n.empty { text-align: center; padding-top: 160rpx; color: #999; }\r\n.empty-img { width: 360rpx; }\r\n.empty-text { display: block; margin-top: 40rpx; font-size: 30rpx; }\r\n</style>","import MiniProgramPage from 'E:/code/wechatDOC/HbUniapp/demoxiaoyuan/pages/user/home.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}