{"version":3,"file":"detail.js","sources":["pages/order/detail.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvb3JkZXIvZGV0YWlsLnZ1ZQ"],"sourcesContent":["<!-- pages/order/detail.vue （终极完美版）-->\r\n<template>\r\n  <view class=\"detail-page\">\r\n    <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n\r\n    <!-- 顶部导航栏 + 万能返回按钮 -->\r\n    <view class=\"nav-bar\">\r\n      <view class=\"left\" @click=\"goBack\">\r\n        <uni-icons type=\"back\" size=\"40\" color=\"#fff\" />\r\n      </view>\r\n      <view class=\"title\">订单详情</view>\r\n      <view class=\"right\"></view>\r\n    </view>\r\n\r\n    <!-- 状态大卡片 -->\r\n    <view class=\"status-header\" :class=\"statusClass\">\r\n      <uni-icons :type=\"statusIcon\" size=\"80\" color=\"#fff\" />\r\n      <text class=\"status-text\">{{ statusMap[order.status] || '未知状态' }}</text>\r\n      <text class=\"tip\">{{ statusTip }}</text>\r\n    </view>\r\n\r\n    <!-- 商品信息 -->\r\n    <view class=\"section goods-section\">\r\n      <view class=\"goods-info\" @click=\"toGoodsDetail\">\r\n        <image :src=\"order.cover || '/static/default-cover.png'\" mode=\"aspectFill\" class=\"cover\" />\r\n        <view class=\"info\">\r\n          <text class=\"title\">{{ order.goodsTitle || '未知商品' }}</text>\r\n          <text class=\"price\">¥{{ order.price }} × {{ order.quantity || 1 }}</text>\r\n        </view>\r\n        <uni-icons type=\"arrowright\" size=\"36\" color=\"#ccc\" />\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 订单信息 -->\r\n    <view class=\"section\">\r\n      <view class=\"info-row\">\r\n        <text class=\"label\">订单编号</text>\r\n        <text class=\"value\" @click=\"copyText(order.id)\">{{ order.id }} <uni-icons type=\"copy\" size=\"28\" color=\"#007AFF\" /></text>\r\n      </view>\r\n      <view class=\"info-row\">\r\n        <text class=\"label\">下单时间</text>\r\n        <text class=\"value\">{{ formatTime(order.createdAt) }}</text>\r\n      </view>\r\n      <view class=\"info-row\">\r\n        <text class=\"label\">收货人</text>\r\n        <text class=\"value\">{{ addressInfo.name || '未填写' }}</text>\r\n      </view>\r\n      <view class=\"info-row\">\r\n        <text class=\"label\">联系电话</text>\r\n        <text class=\"value\">{{ addressInfo.phone || '未填写' }}</text>\r\n      </view>\r\n      <view class=\"info-row\">\r\n        <text class=\"label\">收货地址</text>\r\n        <text class=\"value\">{{ addressInfo.addr || '未填写' }}</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 卖家信息 -->\r\n    <view class=\"section seller-section\">\r\n      <view class=\"seller-info\">\r\n        <image :src=\"order.sellerAvatar || '/static/default-avatar.png'\" class=\"avatar\" mode=\"aspectFill\" />\r\n        <text class=\"nickname\">{{ order.sellerNickname || '匿名卖家' }}</text>\r\n      </view>\r\n      <button class=\"btn contact\" @click=\"contactSeller\">联系卖家</button>\r\n    </view>\r\n\r\n    <!-- 底部操作按钮 -->\r\n    <view class=\"actions-fixed\" v-if=\"showAction\">\r\n      <button v-if=\"order.status === 0\" class=\"btn pay\" @click=\"pay\">立即支付</button>\r\n      <button v-if=\"order.status === 2\" class=\"btn confirm\" @click=\"confirmReceive\">确认收货</button>\r\n      <button v-if=\"order.status === 4\" class=\"btn refund\" @click=\"applyRefund\">申请退款</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      statusBarHeight: 0,\r\n      order: {},\r\n      addressInfo: { name: '', phone: '', addr: '' },\r\n      statusMap: {\r\n        0: '待支付',\r\n        1: '待发货',\r\n        2: '待收货',\r\n        3: '已完成',\r\n        4: '退款中',\r\n        5: '已退款'\r\n      }\r\n    }\r\n  },\r\n\r\n  computed: {\r\n    statusClass() {\r\n      const map = {\r\n        0: 'warning',\r\n        1: 'primary',\r\n        2: 'primary',\r\n        3: 'success',\r\n        4: 'refund',\r\n        5: 'default'\r\n      }\r\n      return map[this.order.status] || 'default'\r\n    },\r\n    statusIcon() {\r\n      const map = {\r\n        0: 'wallet',\r\n        1: 'car',\r\n        2: 'map',\r\n        3: 'checkbox-filled',\r\n        4: 'refresh',\r\n        5: 'info-filled'\r\n      }\r\n      return map[this.order.status] || 'question'\r\n    },\r\n    statusTip() {\r\n      const tips = {\r\n        0: '请在24小时内完成支付，逾期将自动取消',\r\n        1: '卖家正在备货，请耐心等待发货',\r\n        2: '商品已发货，请注意查收',\r\n        3: '交易已完成，感谢你的购买',\r\n        4: '退款申请已提交，请等待处理',\r\n        5: '退款已完成，金额已原路退回'\r\n      }\r\n      return tips[this.order.status] || ''\r\n    },\r\n    showAction() {\r\n      return [0, 2, 4].includes(this.order.status)\r\n    }\r\n  },\r\n\r\n  onLoad(options) {\r\n    this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight\r\n    if (options.id) this.loadDetail(options.id)\r\n  },\r\n\r\n  methods: {\r\n    loadDetail(id) {\r\n      const token = uni.getStorageSync('token')\r\n      uni.request({\r\n        url: `http://192.168.0.105:8080/api/order/${id}`,\r\n        header: { Authorization: 'Bearer ' + token },\r\n        success: (res) => {\r\n          if (res.statusCode === 200 && res.data.order) {\r\n            this.order = res.data.order\r\n            // 解析地址\r\n            try {\r\n              this.addressInfo = typeof this.order.address === 'string'\r\n                ? JSON.parse(this.order.address)\r\n                : this.order.address || {}\r\n            } catch {\r\n              this.addressInfo = { name: '解析失败', phone: '', addr: this.order.address || '' }\r\n            }\r\n            // 处理封面图\r\n            try {\r\n              const imgs = typeof this.order.goodsImages === 'string' ? JSON.parse(this.order.goodsImages) : this.order.goodsImages\r\n              this.order.cover = Array.isArray(imgs) && imgs.length ? imgs[0] : '/static/default-cover.png'\r\n            } catch {\r\n              this.order.cover = '/static/default-cover.png'\r\n            }\r\n          }\r\n        }\r\n      })\r\n    },\r\n\r\n    // 万能返回，永不报错！\r\n    goBack() {\r\n      const pages = getCurrentPages()\r\n      if (pages.length > 1) {\r\n        uni.navigateBack()\r\n      } else {\r\n        uni.switchTab({ url: '/pages/mine/mine' })\r\n      }\r\n    },\r\n\r\n    formatTime(time) {\r\n      if (!time) return '未知时间'\r\n      const date = new Date(time)\r\n      return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')} ${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`\r\n    },\r\n\r\n    copyText(text) {\r\n      uni.setClipboardData({\r\n        data: String(text),\r\n        success: () => uni.showToast({ title: '复制成功' })\r\n      })\r\n    },\r\n\r\n\t// 在订单详情页点击“立即支付”\r\n\tpay() {\r\n\t  uni.request({\r\n\t\turl: 'http://192.168.0.105:8080/api/pay/create',\r\n\t\tmethod: 'POST',\r\n\t\tdata: {\r\n\t\t  description: '校园闲置 - ' + this.order.goodsTitle,\r\n\t\t  amount: Math.round(this.order.price * 100) // 转为分\r\n\t\t},\r\n\t\theader: { Authorization: 'Bearer ' + uni.getStorageSync('token') },\r\n\t\tsuccess: (res) => {\r\n\t\t  if (res.data.payment) {\r\n\t\t\tuni.requestPayment({\r\n\t\t\t  ...res.data.payment,\r\n\t\t\t  success: () => {\r\n\t\t\t\tuni.showToast({ title: '支付成功' })\r\n\t\t\t\tsetTimeout(() => this.loadDetail(this.order.id), 1000)\r\n\t\t\t  },\r\n\t\t\t  fail: () => {\r\n\t\t\t\tuni.showToast({ title: '支付失败', icon: 'none' })\r\n\t\t\t  }\r\n\t\t\t})\r\n\t\t  }\r\n\t\t}\r\n\t  })\r\n\t},\r\n\r\n    confirmReceive() {\r\n      uni.showModal({\r\n        title: '确认收货',\r\n        content: '已收到商品并验收无误？',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            const token = uni.getStorageSync('token')\r\n            uni.request({\r\n              url: `http://192.168.0.105:8080/api/order/status/${this.order.id}?newStatus=3`,\r\n              method: 'PUT',\r\n              header: { Authorization: 'Bearer ' + token },\r\n              success: () => {\r\n                uni.showToast({ title: '确认收货成功' })\r\n                setTimeout(() => this.goBack(), 1000)\r\n              }\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n\r\n    contactSeller() {\r\n      uni.showToast({ title: '已打开客服聊天', icon: 'success' })\r\n    },\r\n\r\n    applyRefund() {\r\n      uni.showModal({\r\n        title: '申请退款',\r\n        content: '确定要申请退款吗？',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            uni.showToast({ title: '退款申请已提交' })\r\n          }\r\n        }\r\n      })\r\n    },\r\n\r\n    toGoodsDetail() {\r\n      if (this.order.goodsId) {\r\n        uni.redirectTo({ url: `/pages/detail/detail?id=${this.order.goodsId}` })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.detail-page { background: #f8f8f8; min-height: 100vh; padding-bottom: 180rpx; }\r\n\r\n/* 顶部返回栏 */\r\n.nav-bar {\r\n  position: fixed; top: 0; left: 0; right: 0; height: 88rpx; background: transparent;\r\n  display: flex; align-items: center; justify-content: space-between; padding: 0 32rpx; z-index: 1000;\r\n}\r\n.nav-bar .title { font-size: 36rpx; font-weight: bold; color: #fff; position: absolute; left: 50%; transform: translateX(-50%); }\r\n\r\n/* 状态卡片 */\r\n.status-header { padding: 120rpx 60rpx 80rpx; text-align: center; color: #fff; border-radius: 0 0 40rpx 40rpx; }\r\n.status-header.warning { background: linear-gradient(135deg, #ff6b6b, #ee5a52); }\r\n.status-header.primary { background: linear-gradient(135deg, #667eea, #764ba2); }\r\n.status-header.success { background: linear-gradient(135deg, #52c41a, #49aa19); }\r\n.status-header.refund { background: linear-gradient(135deg, #722ed1, #531dab); }\r\n.status-header.default { background: #999; }\r\n.status-text { font-size: 52rpx; font-weight: bold; margin-top: 20rpx; }\r\n.tip { font-size: 30rpx; opacity: 0.9; margin-top: 20rpx; display: block; }\r\n\r\n/* 公共卡片 */\r\n.section { margin: 32rpx; background: #fff; border-radius: 24rpx; overflow: hidden; box-shadow: 0 8rpx 30rpx rgba(0,0,0,0.06); }\r\n.goods-section { padding: 32rpx; }\r\n.goods-info { display: flex; align-items: center; justify-content: space-between; }\r\n.cover { width: 200rpx; height: 200rpx; border-radius: 20rpx; }\r\n.info { flex: 1; margin: 0 32rpx; }\r\n.title { font-size: 36rpx; color: #333; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }\r\n.price { font-size: 40rpx; color: #ff4757; margin-top: 20rpx; font-weight: bold; }\r\n\r\n.info-row { display: flex; justify-content: space-between; align-items: center; padding: 32rpx; border-bottom: 1rpx solid #f0f0f0; font-size: 32rpx; }\r\n.info-row:last-child { border-bottom: none; }\r\n.label { color: #999; }\r\n.value { color: #333; text-align: right; flex: 1; margin-left: 20rpx; display: flex; align-items: center; justify-content: flex-end; gap: 10rpx; }\r\n\r\n/* 卖家信息 */\r\n.seller-section { padding: 40rpx 32rpx; display: flex; justify-content: space-between; align-items: center; }\r\n.seller-info { display: flex; align-items: center; }\r\n.seller-info .avatar { width: 100rpx; height: 100rpx; border-radius: 50%; margin-right: 24rpx; }\r\n.nickname { font-size: 34rpx; font-weight: bold; }\r\n.btn.contact { background: #07c160; color: #fff; padding: 16rpx 40rpx; border-radius: 50rpx; }\r\n\r\n/* 底部操作栏 */\r\n.actions-fixed {\r\n  position: fixed; bottom: 40rpx; left: 32rpx; right: 32rpx;\r\n  display: flex; gap: 20rpx; z-index: 1000;\r\n}\r\n.actions-fixed .btn {\r\n  flex: 1; height: 88rpx; line-height: 88rpx; border-radius: 88rpx; font-size: 34rpx;\r\n}\r\n.pay { background: #ff4757; color: #fff; }\r\n.confirm { background: #fff; color: #ff4757; border: 2rpx solid #ff4757; }\r\n.refund { background: #722ed1; color: #fff; }\r\n</style>","import MiniProgramPage from 'E:/code/wechatDOC/HbUniapp/demoxiaoyuan/pages/order/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}